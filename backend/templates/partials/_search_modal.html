{% load i18n %}
{# ── SEARCH MODAL ── #}
<div
  x-data="{
    open: false,
    init() {
      this.$watch('open', v => {
        document.documentElement.classList.toggle('modal-open', v);
        document.documentElement.style.overflow = v ? 'hidden' : '';
        if (v) this.$nextTick(() => this.$refs.q?.focus());
      });
    }
  }"
  x-cloak
  @open-search.window="open = true"
  @keydown.escape.window="open = false"
  x-show="open"
  class="fixed inset-0 z-[2147483647] isolate"
  style="display: none"
>
  {# Backdrop #}
  <div
    class="absolute inset-0 bg-black/25 backdrop-blur-[2px]"
    @click="open = false"
  ></div>

  {# Panel #}
  <div
    class="absolute inset-x-0 top-0"
    x-show="open"
    x-transition:enter="transition ease-out duration-300"
    x-transition:enter-start="-translate-y-full opacity-0"
    x-transition:enter-end="translate-y-0 opacity-100"
    x-transition:leave="transition ease-in duration-200"
    x-transition:leave-start="translate-y-0 opacity-100"
    x-transition:leave-end="-translate-y-full opacity-0"
  >
    {# Mini header #}
    <div class="bg-paper border-b border-rule/60">
      <div class="max-w-7xl mx-auto px-5 md:px-6 py-3 flex items-center">
        <a
          href="/"
          class="font-serif text-[1.4rem] md:text-[1.7rem]
                 font-medium tracking-tight text-ink
                 hover:opacity-70 transition-opacity"
        >
          Art Leptis
        </a>
        <div class="ml-auto flex items-center gap-2">
          <button
            type="button"
            @click="open = false"
            class="header-icon-btn"
            aria-label="{% trans 'Close search' %}"
          >
            <svg class="w-[19px] h-[19px]" fill="none"
                 stroke="currentColor" stroke-width="1.5"
                 viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round"
                    d="M6 18L18 6M6 6l12 12"/>
            </svg>
          </button>
          <a href="{% url 'cart_detail' %}" class="header-icon-btn"
             aria-label="{% trans 'Cart' %}">
            <span class="w-[25px] h-[25px] rounded-full border
                         border-ink/25 inline-flex items-center
                         justify-center text-[10px] font-semibold
                         text-ink-60 leading-none">
              {{ cart|length|default:"0" }}
            </span>
          </a>
        </div>
      </div>
    </div>

    {# Search input #}
    <div class="bg-ink">
      <div class="max-w-7xl mx-auto px-5 md:px-6">
        <form
          method="get"
          action="{% url 'products:product_list' %}"
          class="flex items-center"
          @submit="open = false"
        >
          <input
            name="q"
            type="search"
            x-ref="q"
            autocomplete="off"
            placeholder="{% trans 'Tableware, sculptures, driftwood lamps…' %}"
            class="flex-1 bg-transparent py-4 md:py-5 text-base
                   md:text-lg text-paper/90 placeholder:text-paper/35
                   font-sans tracking-wide outline-none border-none"
          />
          <button
            type="submit"
            class="shrink-0 p-2 text-paper/50 hover:text-paper
                   transition-colors"
            aria-label="{% trans 'Submit search' %}"
          >
            <svg class="w-5 h-5" fill="none" stroke="currentColor"
                 stroke-width="1.5" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round"
                    d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
            </svg>
          </button>
        </form>
      </div>
    </div>

    {# Suggestions #}
    <div class="bg-paper border-b border-rule/40">
      <div class="max-w-7xl mx-auto px-5 md:px-6 py-3
                  flex flex-wrap items-center gap-x-5 gap-y-2">
        <span class="text-meta">{% trans "Popular" %}</span>
        <a href="{% url 'products:product_list' %}?q=Lamp" @click="open = false"
           class="text-sm text-ink-60 hover:text-ink transition-colors">
          {% trans "Lamp" %}
        </a>
        <a href="{% url 'products:product_list' %}?q=Ceramic" @click="open = false"
           class="text-sm text-ink-60 hover:text-ink transition-colors">
          {% trans "Ceramic" %}
        </a>
        <a href="{% url 'products:product_list' %}?q=Driftwood" @click="open = false"
           class="text-sm text-ink-60 hover:text-ink transition-colors">
          {% trans "Driftwood" %}
        </a>
        <a href="{% url 'products:product_list' %}?q=Sculpture" @click="open = false"
           class="text-sm text-ink-60 hover:text-ink transition-colors">
          {% trans "Sculpture" %}
        </a>
      </div>
    </div>
  </div>
</div>