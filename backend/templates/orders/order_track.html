{% extends "base.html" %}

{% block title %}Order #{{ order.id }} Tracking | Arti Corner{% endblock %}

{% block content %}
<div class="mx-auto max-w-3xl px-4 sm:px-6 py-12">

  <div class="flex items-end justify-between gap-6">
    <div>
      <p class="text-xs font-bold tracking-[0.22em] text-arti-dark/60 uppercase">Order tracking</p>
      <h1 class="headline-serif mt-3 text-4xl">Order #{{ order.id }}</h1>
      <p class="mt-2 text-sm opacity-70">
        Payment status:
        <span class="font-medium">{{ order.get_status_display }}</span>
      </p>
    </div>

    {% if request.user.is_authenticated %}
      <a href="{% url 'orders_list' %}" class="text-sm underline opacity-70 hover:opacity-100">Back to orders</a>
    {% endif %}
  </div>

  <div class="mt-8 rounded-3xl border border-arti-dark/10 bg-white p-6 sm:p-7">
    <p class="text-xs uppercase tracking-widest opacity-60">Fulfillment</p>
    <p class="mt-2 text-2xl font-medium">{{ tracking.get_status_display }}</p>

    <div class="mt-6 grid gap-3 text-sm opacity-80">
      <div class="flex items-center justify-between">
        <span>Processing</span>
        <span>{% if tracking.processing_at %}{{ tracking.processing_at|date:"Y-m-d H:i" }}{% else %}-{% endif %}</span>
      </div>
      <div class="flex items-center justify-between">
        <span>Packed</span>
        <span>{% if tracking.packed_at %}{{ tracking.packed_at|date:"Y-m-d H:i" }}{% else %}-{% endif %}</span>
      </div>
      <div class="flex items-center justify-between">
        <span>Shipped</span>
        <span>{% if tracking.shipped_at %}{{ tracking.shipped_at|date:"Y-m-d H:i" }}{% else %}-{% endif %}</span>
      </div>
      <div class="flex items-center justify-between">
        <span>Delivered</span>
        <span>{% if tracking.delivered_at %}{{ tracking.delivered_at|date:"Y-m-d H:i" }}{% else %}-{% endif %}</span>
      </div>
    </div>

    <div class="mt-8 border-t border-arti-dark/10 pt-6">
      <p class="text-xs uppercase tracking-widest opacity-60">Shipping</p>

      {% if tracking.carrier or tracking.tracking_number %}
        <div class="mt-3 space-y-2 text-sm">
          {% if tracking.carrier %}
            <p><span class="opacity-60">Carrier:</span> <span class="font-medium">{{ tracking.carrier }}</span></p>
          {% endif %}
          {% if tracking.tracking_number %}
            <p><span class="opacity-60">Tracking number:</span> <span class="font-medium">{{ tracking.tracking_number }}</span></p>
          {% endif %}
        </div>
      {% else %}
        <p class="mt-3 text-sm opacity-70">
          Tracking details will appear once your order has shipped.
        </p>
      {% endif %}

      {% if tracking.delivery_notes %}
        <div class="mt-5 rounded-2xl bg-arti-dark/5 p-4 text-sm">
          <p class="text-xs uppercase tracking-widest opacity-60 mb-2">Delivery notes</p>
          <p class="opacity-80">{{ tracking.delivery_notes }}</p>
        </div>
      {% endif %}
    </div>
  </div>

  {% if events %}
    <div class="mt-8 rounded-3xl border border-arti-dark/10 bg-white p-6 sm:p-7">
      <p class="text-xs uppercase tracking-widest opacity-60">History</p>
      <div class="mt-4 space-y-3 text-sm">
        {% for ev in events %}
          <div class="flex items-start justify-between gap-6 border-b border-arti-dark/10 pb-3 last:border-0 last:pb-0">
            <div class="min-w-0">
              <p class="font-medium">
                {{ ev.from_status|default:"-" }} â†’ {{ ev.to_status }}
              </p>
              {% if ev.note %}
                <p class="mt-1 opacity-70">{{ ev.note }}</p>
              {% endif %}
            </div>
            <p class="shrink-0 opacity-60">{{ ev.created_at|date:"Y-m-d H:i" }}</p>
          </div>
        {% endfor %}
      </div>
    </div>
  {% endif %}

</div>
{% endblock %}
