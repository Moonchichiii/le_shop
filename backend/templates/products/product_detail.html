{% extends "base.html" %}

{% block title %}{{ product.name }} | Art Leptis{% endblock %}

{% block content %}
<section class="artleptis">

  <!-- BREADCRUMB STRIP -->
  <div class="border-b border-rule">
    <div class="mx-auto max-w-7xl px-4 sm:px-6 py-3 flex items-center gap-2">
      <a
        href="{% url 'product_list' %}"
        class="inline-flex items-center gap-1.5 text-[10px] font-bold uppercase tracking-[0.18em] text-ink-60 hover:text-ink transition-colors duration-200"
      >
        <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24">
          <path stroke-linecap="square" d="M15 19l-7-7 7-7" />
        </svg>
        Back to shop
      </a>
    </div>
  </div>

  <!-- PRODUCT GRID -->
  <div class="mx-auto max-w-7xl px-4 sm:px-6 py-section-sm">
    <div class="grid gap-0 md:grid-cols-2">

      <!-- ── COL 1 : IMAGE ── -->
      <div class="reveal-scale">
        <div class="plate aspect-[4/5] overflow-hidden">
          <img
            src="{{ product.image_url_auto }}"
            srcset="
              {{ product.image_url_800 }} 800w,
              {{ product.image_url_1200 }} 1200w
            "
            sizes="(min-width: 768px) 50vw, 100vw"
            alt="{{ product.name }}"
            class="w-full h-full object-cover"
            fetchpriority="high"
            decoding="async"
          />
        </div>
        <div class="mt-3 flex items-center justify-between">
          <span class="text-meta">FIG. 01</span>
          <span class="text-meta">{{ product.category.name }}</span>
        </div>
      </div>

      <!-- ── COL 2 : DETAILS ── -->
      <div class="md:pl-12 lg:pl-16 pt-10 md:pt-0 flex flex-col">

        <div class="reveal-up">
          <span class="label">{{ product.category.name }}</span>
        </div>

        <h1 class="headline-serif mt-4 text-4xl sm:text-5xl lg:text-6xl reveal-up">
          {{ product.name }}
        </h1>

        <div class="rule mt-6 mb-6"></div>

        <p class="text-base leading-relaxed text-ink-60 max-w-prose reveal-up">
          {{ product.description }}
        </p>

        <div class="mt-8 flex items-end justify-between border-b border-rule pb-6 reveal-up">
          <div>
            <span class="text-meta block mb-1">Price</span>
            <p class="headline-serif text-3xl lg:text-4xl">€{{ product.price }}</p>
          </div>
          <div class="text-right">
            <span class="text-meta block mb-1">Availability</span>
            {% if product.is_in_stock %}
              <span class="badge badge--stock">In stock</span>
            {% else %}
              <span class="badge badge--sold-out">Sold out</span>
            {% endif %}
          </div>
        </div>

        <div class="mt-8 reveal-up">
          {% if product.is_in_stock %}
            <form
              method="post"
              action="{% url 'cart_add' product.id %}"
              class="flex flex-col sm:flex-row gap-3 sm:items-stretch"
            >
              {% csrf_token %}

              <div class="relative sm:w-28">
                <label for="qty" class="sr-only">Quantity</label>
                <span class="absolute top-1 left-3 text-[9px] font-bold uppercase tracking-[0.18em] text-slate-400 pointer-events-none">
                  Qty
                </span>
                <!-- 
                   CRITICAL FIX: 'max' attribute removed. 
                   We let the user type any number, and the server clamps it.
                -->
                <input
                  id="qty"
                  name="qty"
                  type="number"
                  min="1"
                  value="1"
                  class="w-full h-full border border-rule bg-transparent px-3 pt-5 pb-2 text-sm font-semibold text-ink focus:outline-none focus:border-ink transition-colors duration-200"
                />
              </div>

              <button type="submit" class="btn-primary flex-1 sm:flex-none">
                Add to cart
              </button>

              <a href="{% url 'cart_detail' %}" class="btn-outline flex-1 sm:flex-none">
                View cart
              </a>
            </form>
          {% else %}
            <button class="btn-outline w-full opacity-50 cursor-not-allowed" disabled>
              Sold out
            </button>
          {% endif %}
        </div>

        <div class="flex-1"></div>

        <div class="hidden md:flex items-center justify-between mt-12 pt-4 border-t border-rule reveal-up">
          <span class="text-meta">REF. {{ product.id|stringformat:"04d" }}</span>
          <span class="text-meta">Art Leptis — Catalogue</span>
        </div>

      </div>
    </div>
  </div>
</section>
{% endblock %}