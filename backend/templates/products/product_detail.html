{% extends "base.html" %}
{% load i18n %}

{% block title %}{{ product.name }} | Art Leptis{% endblock %}

{% block content %}
<section class="artleptis">

  <!-- BREADCRUMB -->
  <div class="border-b border-rule">
    <div class="mx-auto max-w-7xl px-4 sm:px-6 py-3 flex items-center">
      <a
        href="{% url 'product_list' %}"
        class="inline-flex items-center gap-1.5 text-[10px] font-bold
               uppercase tracking-[0.18em] text-ink-60
               hover:text-ink transition-colors duration-200"
      >
        <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor"
             stroke-width="1.5" viewBox="0 0 24 24">
          <path stroke-linecap="round" d="M15 19l-7-7 7-7" />
        </svg>
        {% trans "Back to shop" %}
      </a>
    </div>
  </div>

  <!-- PRODUCT GRID -->
  <div class="mx-auto max-w-7xl px-4 sm:px-6 py-section-sm">
    <div class="grid gap-0 md:grid-cols-2">

      <!-- COL 1 : IMAGE -->
      <div class="reveal-scale">
        <div class="plate aspect-[4/5] overflow-hidden">
          <img
            src="{{ product.image_url_auto }}"
            srcset="
              {{ product.image_url_800 }} 800w,
              {{ product.image_url_1200 }} 1200w
            "
            sizes="(min-width: 768px) 50vw, 100vw"
            alt="{{ product.name }}"
            class="w-full h-full object-cover"
            fetchpriority="high"
            decoding="async"
          />
        </div>
      </div>

      <!-- COL 2 : DETAILS -->
      <div class="md:pl-12 lg:pl-16 pt-10 md:pt-0 flex flex-col">

        <div class="reveal-up">
          <span class="label">{{ product.category.name }}</span>
        </div>

        <h1 class="headline-serif mt-4 text-4xl sm:text-5xl lg:text-6xl
                   reveal-up">
          {{ product.name }}
        </h1>

        <div class="rule mt-6 mb-6"></div>

        <p class="text-base leading-relaxed text-ink-60 max-w-prose
                  reveal-up">
          {{ product.description }}
        </p>

        <!-- PRICE + STOCK -->
        <div class="mt-8 flex items-end justify-between border-b
                    border-rule pb-6 reveal-up">
          <p class="headline-serif text-3xl lg:text-4xl">
            €{{ product.price }}
          </p>
          <div>
            {% if product.is_in_stock %}
              <span class="badge badge--stock">
                {% trans "In stock" %}
              </span>
            {% else %}
              <span class="badge badge--sold-out">
                {% trans "Sold out" %}
              </span>
            {% endif %}
          </div>
        </div>

        <!-- ADD TO CART -->
        <div class="mt-8 reveal-up">
          {% if product.is_in_stock %}
            <form
              method="post"
              action="{% url 'cart_add' product.id %}"
              class="flex flex-col sm:flex-row gap-3 sm:items-stretch"
            >
              {% csrf_token %}

              <div class="relative sm:w-28">
                <label for="qty" class="sr-only">
                  {% trans "Quantity" %}
                </label>
                <span class="absolute top-1 left-3 text-[9px] font-bold
                             uppercase tracking-[0.18em] text-ink-40
                             pointer-events-none">
                  {% trans "Qty" %}
                </span>
                <input
                  id="qty"
                  name="qty"
                  type="number"
                  min="1"
                  value="1"
                  class="w-full h-full rounded-lg border border-rule
                         bg-transparent px-3 pt-5 pb-2 text-sm
                         font-semibold text-ink focus:outline-none
                         focus:border-ink transition-colors duration-200"
                />
              </div>

              <button type="submit"
                      class="btn-primary flex-1 sm:flex-none">
                {% trans "Add to cart" %}
              </button>

              <a href="{% url 'cart_detail' %}"
                 class="btn-outline flex-1 sm:flex-none">
                {% trans "View cart" %}
              </a>
            </form>
          {% else %}
            <button
              class="btn-outline w-full opacity-50 cursor-not-allowed"
              disabled
            >
              {% trans "Sold out" %}
            </button>
          {% endif %}
        </div>

        <div class="flex-1"></div>

        <!-- FOOTER META — warm, no REF/FIG -->
        <div class="hidden md:flex items-center gap-3 mt-12 pt-4
                    border-t border-rule reveal-up">
          <span class="text-meta">{{ product.category.name }}</span>
          <span class="text-ink-20">·</span>
          <span class="text-meta">Art Leptis</span>
        </div>

      </div>
    </div>
  </div>
</section>
{% endblock %}