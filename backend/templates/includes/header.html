<header
  class="fixed top-0 left-0 w-full z-40 transition-all duration-300"
  x-data="{ scrolled: false, mobileOpen: false, accountOpen: false }"
  @scroll.window="scrolled = (window.pageYOffset > 20)"
  @keydown.escape.window="mobileOpen = false; accountOpen = false"
  :class="scrolled ? 'nav-glass py-3' : 'bg-transparent py-5'"
>
  <div class="max-w-7xl mx-auto px-6 flex items-center justify-between">

    <!-- Logo -->
    <a href="/" class="font-serif text-2xl font-bold tracking-tight text-arti-dark">
      Arti Corner
    </a>

    <!-- Desktop Nav (no auth links here) -->
    <nav class="hidden md:flex items-center gap-8 text-sm font-medium text-arti-dark/80">
      <a href="{% url 'product_list' %}" class="hover:text-arti-dark transition">Shop</a>
      <a href="#" class="hover:text-arti-dark transition">About</a>
      <a href="#" class="hover:text-arti-dark transition">Journal</a>
    </nav>

    <!-- Actions -->
    <div class="flex items-center gap-4">

      <!-- Search -->
      <button
        type="button"
        @click="$dispatch('open-search')"
        class="hover:opacity-70 transition text-arti-dark"
        aria-label="Search"
      >
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
        </svg>
      </button>

      <!-- Bag / Cart -->
      <a href="{% url 'cart_detail' %}" class="relative hover:opacity-70 transition text-arti-dark" aria-label="Cart">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"></path>
        </svg>

        {% if cart and cart|length > 0 %}
          <span class="absolute -top-1 -right-1 min-w-5 h-5 px-1 rounded-full bg-orange-400 text-[10px] font-bold flex items-center justify-center">
            {{ cart|length }}
          </span>
        {% else %}
          <span class="absolute -top-1 -right-1 w-2.5 h-2.5 bg-orange-400 rounded-full"></span>
        {% endif %}
      </a>

      <!-- Account dropdown (DESKTOP ONLY) -->
      <div class="hidden md:relative md:block" @click.outside="accountOpen = false">
        <button
          type="button"
          class="hover:opacity-70 transition text-arti-dark"
          aria-label="Account"
          :aria-expanded="accountOpen.toString()"
          aria-haspopup="menu"
          @click="accountOpen = !accountOpen"
        >
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
          </svg>
        </button>

        <div
          x-show="accountOpen"
          x-transition.opacity
          x-cloak
          class="absolute right-0 mt-3 w-56 rounded-3xl border border-arti-dark/10 bg-white shadow-xl overflow-hidden"
          role="menu"
          style="display:none"
        >
          {% if request.user.is_authenticated %}
            <div class="px-4 py-3 border-b border-arti-dark/10">
              <p class="text-xs uppercase tracking-widest opacity-60">Signed in</p>
              <p class="text-sm font-medium truncate">{{ request.user.email }}</p>
            </div>

            <a href="#" class="block px-4 py-3 text-sm hover:bg-arti-dark/5" role="menuitem">
              Account
            </a>
            <a href="{% url 'orders_list' %}" class="block px-4 py-3 text-sm hover:bg-arti-dark/5" role="menuitem">
              Orders
            </a>

            <form method="post" action="{% url 'account_logout' %}" class="border-t border-arti-dark/10">
              {% csrf_token %}
              <button type="submit" class="w-full text-left px-4 py-3 text-sm hover:bg-arti-dark/5">
                Sign out
              </button>
            </form>
          {% else %}
            <a href="{% url 'account_login' %}" class="block px-4 py-3 text-sm hover:bg-arti-dark/5" role="menuitem">
              Sign in
            </a>
            <a href="{% url 'account_signup' %}" class="block px-4 py-3 text-sm hover:bg-arti-dark/5" role="menuitem">
              Create account
            </a>
          {% endif %}
        </div>
      </div>

      <!-- Mobile Hamburger -->
      <button
        type="button"
        class="md:hidden hover:opacity-70 transition text-arti-dark"
        @click="mobileOpen = !mobileOpen"
        :aria-expanded="mobileOpen.toString()"
        aria-controls="mobile-menu"
        aria-label="Open menu"
      >
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M4 6h16M4 12h16m-7 6h7"></path>
        </svg>
      </button>
    </div>
  </div>

  <!-- Mobile Menu Backdrop -->
  <div
    x-show="mobileOpen"
    x-transition.opacity
    class="fixed inset-0 bg-black/30 md:hidden"
    @click="mobileOpen = false"
    style="display:none"
  ></div>

  <!-- Mobile Drawer -->
  <div
    id="mobile-menu"
    x-show="mobileOpen"
    x-transition:enter="transition ease-out duration-250"
    x-transition:enter-start="opacity-0 -translate-y-2"
    x-transition:enter-end="opacity-100 translate-y-0"
    x-transition:leave="transition ease-in duration-200"
    x-transition:leave-start="opacity-100 translate-y-0"
    x-transition:leave-end="opacity-0 -translate-y-2"
    class="md:hidden absolute left-0 right-0 top-full px-4"
    style="display:none"
  >
    <div class="mt-3 rounded-3xl border border-arti-dark/10 bg-white p-4 shadow-xl">
      <a href="{% url 'product_list' %}" class="block px-4 py-3 rounded-2xl hover:bg-arti-dark/5">Shop</a>
      <a href="#" class="block px-4 py-3 rounded-2xl hover:bg-arti-dark/5">About</a>
      <a href="#" class="block px-4 py-3 rounded-2xl hover:bg-arti-dark/5">Journal</a>

      <div class="mt-2 border-t border-arti-dark/10 pt-2">
        <a href="{% url 'cart_detail' %}" class="block px-4 py-3 rounded-2xl hover:bg-arti-dark/5">Cart</a>

        {% if request.user.is_authenticated %}
          <a href="{% url 'orders_list' %}" class="block px-4 py-3 rounded-2xl hover:bg-arti-dark/5">Orders</a>
          <form method="post" action="{% url 'account_logout' %}">
            {% csrf_token %}
            <button type="submit" class="w-full text-left block px-4 py-3 rounded-2xl hover:bg-arti-dark/5">
              Sign out
            </button>
          </form>
        {% else %}
          <a href="{% url 'account_login' %}" class="block px-4 py-3 rounded-2xl hover:bg-arti-dark/5">Sign in</a>
          <a href="{% url 'account_signup' %}" class="block px-4 py-3 rounded-2xl hover:bg-arti-dark/5">Create account</a>
        {% endif %}
      </div>
    </div>
  </div>
</header>
