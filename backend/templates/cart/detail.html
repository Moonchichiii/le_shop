{% extends "base.html" %}
{% load static %}

{% block title %}Your Cart | Arti Corner{% endblock %}

{% block content %}
<div class="mx-auto max-w-4xl px-4 sm:px-6 py-12">
   
    {% if messages %}
        <div class="mb-8 flex flex-col gap-2">
            {% for message in messages %}
                <div class="rounded-2xl px-5 py-3 text-sm flex items-center gap-3
                    {% if 'error' in message.tags %}bg-red-50 text-red-700 border border-red-100{% else %}bg-arti-gray text-arti-dark border border-arti-dark/5{% endif %}">
                    {{ message }}
                </div>
            {% endfor %}
        </div>
    {% endif %}

    <div class="flex items-end justify-between">
        <div>
            <h1 class="headline-serif mt-3 text-4xl">Your Cart</h1>
        </div>
        <a href="{% url 'product_list' %}" class="text-sm font-bold underline decoration-arti-dark/30 hover:decoration-arti-accent transition-all">
            Continue shopping
        </a>
    </div>

    {% if cart|length == 0 %}
        <div class="mt-10 rounded-4xl border border-arti-dark/10 bg-white p-12 text-center">
            <p class="text-arti-dark/50 text-lg">Your cart is currently empty.</p>
            <a href="{% url 'product_list' %}" class="btn-primary mt-6">Start Browsing</a>
        </div>
    {% else %}
        <div class="mt-10 space-y-6">
            {% for item in cart %}
                {% with product=item.product %}
                    <div class="flex flex-col sm:flex-row gap-6 rounded-4xl bg-white p-5 shadow-sm border border-arti-dark/5">
                        <a href="{{ product.get_absolute_url }}" class="h-28 w-28 shrink-0 overflow-hidden rounded-2xl bg-arti-gray">
                            <img
                                src="{{ product.image_url_400 }}"
                                class="h-full w-full object-cover"
                                alt="{{ product.image_alt }}"
                                loading="lazy"
                            />
                        </a>

                        <div class="flex flex-1 flex-col justify-between">
                            <div class="flex justify-between items-start">
                                <div>
                                    <h3 class="font-serif text-xl"><a href="{{ product.get_absolute_url }}">{{ product.name }}</a></h3>
                                    <p class="text-xs font-bold uppercase tracking-widest opacity-50 mt-1">{{ product.category.name }}</p>
                                </div>
                                <p class="font-bold text-lg">€{{ item.total_price }}</p>
                            </div>

                            <div class="flex items-center justify-between mt-4">
                                <div class="flex items-center gap-3 bg-arti-gray rounded-full px-2 py-1">
                                    <form method="post" action="{% url 'cart_update' product.id %}">
                                        {% csrf_token %}
                                        <input type="hidden" name="qty" value="{{ item.qty|add:'-1' }}">
                                        <button class="w-8 h-8 flex items-center justify-center rounded-full hover:bg-white transition text-arti-dark disabled:opacity-30" {% if item.qty <= 1 %}disabled{% endif %}>-</button>
                                    </form>
                                    <span class="text-sm font-bold w-4 text-center">{{ item.qty }}</span>
                                    <form method="post" action="{% url 'cart_update' product.id %}">
                                        {% csrf_token %}
                                        <input type="hidden" name="qty" value="{{ item.qty|add:'1' }}">
                                        <button class="w-8 h-8 flex items-center justify-center rounded-full hover:bg-white transition text-arti-dark">+</button>
                                    </form>
                                </div>

                                <form method="post" action="{% url 'cart_remove' product.id %}">
                                    {% csrf_token %}
                                    <button class="text-xs font-bold text-red-600 hover:text-red-700 underline decoration-red-200">Remove</button>
                                </form>
                            </div>
                        </div>
                    </div>
                {% endwith %}
            {% endfor %}
        </div>

        <div class="mt-10 rounded-4xl bg-arti-dark text-white p-8 sm:p-10">
            <div class="flex flex-col gap-6 sm:flex-row sm:items-center sm:justify-between">
                <div>
                    <p class="text-xs uppercase tracking-widest opacity-60">Total Amount</p>
                    <p class="headline-serif mt-2 text-5xl">€{{ cart.get_total_price }}</p>
                    <p class="mt-2 text-sm opacity-60">Shipping and taxes calculated next.</p>
                </div>

                <form method="post" action="{% url 'checkout_start' %}" class="w-full sm:w-auto">
                    {% csrf_token %}
                    <button type="submit" class="w-full sm:w-auto inline-flex items-center justify-center gap-2 rounded-full bg-arti-accent text-white px-10 py-4 text-sm font-bold tracking-wide transition-all hover:bg-white hover:text-arti-dark hover:scale-105">
                        Proceed to Checkout
                    </button>
                </form>
            </div>
        </div>
    {% endif %}
</div>
{% endblock %}
